<form class="file-form" [formGroup]="form" (ngSubmit)="submit()">
  <h1>Add files to an Esploro asset</h1>

  <section class="form-section">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Asset ID</mat-label>
      <input matInput formControlName="assetId" placeholder="e.g. 12345678900001234" />
      <mat-error *ngIf="form.get('assetId')?.hasError('required')">Asset ID is required.</mat-error>
    </mat-form-field>
  </section>

  <section class="file-type-hint" *ngIf="fileTypes.length">
    <h2>Available file types</h2>
    <p class="hint-text">Select one of the configured file types when uploading each file.</p>
    <div class="file-type-list">
      <div class="file-type-item" *ngFor="let type of fileTypes">
        <span class="code">{{ type.value }}</span>
        <span class="description" *ngIf="type.description && type.description !== type.value">{{ type.description }}</span>
      </div>
    </div>
  </section>

  <section formArrayName="files" class="files-section">
    <mat-card class="file-card" *ngFor="let fileGroup of files.controls; let i = index; trackBy: trackByIndex" [formGroupName]="i">
      <div class="file-card__header">
        <h2>File {{ i + 1 }}</h2>
        <button mat-icon-button type="button" color="warn" (click)="removeFile(i)" *ngIf="files.length > 1">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>File name</mat-label>
        <input matInput formControlName="title" placeholder="Display name shown in Esploro" />
        <mat-error *ngIf="fileGroup.get('title')?.hasError('required')">File name is required.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>File URL</mat-label>
        <input matInput formControlName="url" placeholder="https://example.com/file.pdf" />
        <mat-hint>Provide the fully qualified URL from which Esploro can download the file.</mat-hint>
        <mat-error *ngIf="fileGroup.get('url')?.hasError('required')">File URL is required.</mat-error>
        <mat-error *ngIf="fileGroup.get('url')?.hasError('pattern')">Enter a valid http(s) URL.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" rows="2" placeholder="Optional description shown to researchers"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>File type</mat-label>
        <mat-select formControlName="type" [disabled]="loadingFileTypes && !fileTypes.length">
          <mat-option *ngFor="let type of fileTypes" [value]="type.value">
            {{ type.value }}<span *ngIf="type.description && type.description !== type.value"> — {{ type.description }}</span>
          </mat-option>
        </mat-select>
        <mat-hint *ngIf="loadingFileTypes">Loading file types…</mat-hint>
        <mat-error *ngIf="fileGroup.get('type')?.hasError('required')">Select a file type.</mat-error>
      </mat-form-field>

      <mat-checkbox formControlName="supplemental">Supplemental file</mat-checkbox>
    </mat-card>
  </section>

  <div class="add-file-row">
    <button mat-stroked-button color="primary" type="button" (click)="addFile()">
      <mat-icon>add</mat-icon>
      <span>Add another file</span>
    </button>
  </div>

  <div class="form-actions">
    <button mat-flat-button color="primary" type="submit" [disabled]="submitting">Submit files</button>
  </div>

  <mat-progress-bar *ngIf="submitting" mode="indeterminate"></mat-progress-bar>

  <div class="submission-result" *ngIf="submissionResult" [ngClass]="submissionResult.type">
    {{ submissionResult.message }}
  </div>
</form>